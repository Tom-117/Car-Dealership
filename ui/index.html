<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Car Dealership Inventory</title>

   
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 text-gray-900 min-h-screen p-6">

    <div class="max-w-6xl mx-auto">
        
        
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-3xl font-bold">Car Inventory</h1>
            <button onclick="loadCars()" 
                class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded shadow">
                Refresh
            </button>
        </div>

        
        <div class="bg-white shadow rounded-lg overflow-hidden">
            <table class="min-w-full text-left border-collapse">
                <thead class="bg-gray-100 border-b">
                    <tr>
                        <th class="p-3 font-semibold">Make</th>
                        <th class="p-3 font-semibold">Model</th>
                        <th class="p-3 font-semibold">Year</th>
                        <th class="p-3 font-semibold">Price</th>
                        <th class="p-3 font-semibold">VIN</th>
                        <th class="p-3 font-semibold">Color</th>
                        <th class="p-3 font-semibold">Actions</th>
                    </tr>
                </thead>
                <tbody id="carTableBody"></tbody>
            </table>
        </div>

        
        <h2 class="text-2xl font-semibold mt-10 mb-4">Add Car</h2>
        <form id="carForm" class="bg-white p-6 rounded-lg shadow space-y-4">

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <input id="make" type="text" required placeholder="Make"
                    class="border p-2 rounded w-full">

                <input id="model" type="text" required placeholder="Model"
                    class="border p-2 rounded w-full">

                <input id="year" type="number" required placeholder="Year"
                    class="border p-2 rounded w-full">

                <input id="price" type="number" step="0.01" required placeholder="Price"
                    class="border p-2 rounded w-full">

                <input id="vin" type="text" required placeholder="VIN"
                    class="border p-2 rounded w-full">

                <input id="color" type="text" required placeholder="Color"
                    class="border p-2 rounded w-full">
            </div>

            <button type="submit"
                class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded shadow">
                Add Car
            </button>
        </form>
    </div>

<script>
    const API_URL = (window.location.port === "8080")
        ? "http://localhost:8000"
        : "";

    async function loadCars() {
        try {
            const res = await fetch(`${API_URL}/cars`);
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            const cars = await res.json();

            const tbody = document.getElementById("carTableBody");
            tbody.innerHTML = cars.map(car => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="p-3">${car.make}</td>
                    <td class="p-3">${car.model}</td>
                    <td class="p-3">${car.year}</td>
                    <td class="p-3">$${Number(car.price).toFixed(2)}</td>
                    <td class="p-3">${car.vin}</td>
                    <td class="p-3">${car.color}</td>
                    <td class="p-3">
                        <button onclick="deleteCar(${car.id})"
                            class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded">
                            Delete
                        </button>
                    </td>
                </tr>
            `).join('');
        } catch (e) {
            console.error("Load failed:", e);
            alert("Failed to load cars. Check console.");
        }
    }

    document.getElementById('carForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const car = {
            make: document.getElementById('make').value,
            model: document.getElementById('model').value,
            year: parseInt(document.getElementById('year').value),
            price: parseFloat(document.getElementById('price').value),
            vin: document.getElementById('vin').value,
            color: document.getElementById('color').value
        };

        try {
            const res = await fetch(`${API_URL}/cars`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(car)
            });
            if (!res.ok) throw new Error(`HTTP ${res.status}`);

            loadCars();
            e.target.reset();
        } catch (e) {
            console.error("Add failed:", e);
            alert("Failed to add car.");
        }
    });

    async function deleteCar(id) {
        if (!confirm("Delete this car?")) return;

        try {
            const res = await fetch(`${API_URL}/cars/${id}`, { method: 'DELETE' });
            if (!res.ok) throw new Error(`HTTP ${res.status}`);

            loadCars();
        } catch (e) {
            console.error("Delete failed:", e);
            alert("Failed to delete.");
        }
    }

    loadCars();
</script>

</body>
</html>
